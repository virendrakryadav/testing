/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */


  
    function selectSubCategory(category_id , categoryImg , categoryName , returnid)
    {

        var htmlCnt ='<div class="cat_type"><img width="100%" src="'+categoryImg+'">'+categoryName+'</div>';
        $('.owl-wrapper-outer .owl-item .item  .task_cat').removeClass('cat_bg2');
                    $('#category_'+category_id).addClass('cat_bg2');
                    closepopup();
                    selectCategoryByTaskType(category_id);
                    getFormDataByCategory(category_id);
                    formProcess();
                    $(returnid).html(htmlCnt);
                    loaddetailform();
    }
   
   
  
   function getTaskType(taskType)
   {
        $("#taskTypeTab ul li a").removeClass("active");
        $("#taskTypeTab ul li a."+taskType).addClass("active");
        $("#taskTypeTabsContant .taskContant").css('display' , 'none');
        $("#taskTypeTabsContant #"+taskType).css('display' , 'block');
        $('#selectTaskType').val(taskType);
        
        $('#type_title h1').css('display' , 'none');
        $('#title_'+taskType).css('display' , 'block');
        $("#categoriesOnTitle").hide();
        
        
        formProcess();
        
        loadtaskform(taskType);
        if($('#selectCategory'+taskType).val())
        {
           getFormDataByCategory($('#selectCategory'+taskType).val());
        }
   }
   function loaddetailform()
   {
       ////
       var  taskType = $('#selectTaskType').val();
       $("#taskStep1").addClass("vstep1b");
       $("#taskStep2").addClass("vstep1a");
       $("#taskStep2").next().addClass("vtext1");
       $("#taskStep2").parent().addClass("cursor-pointer");
       $("#accordionDiv").show();
       $("#taskDetailFrom").show();
      
      
        $("#taskSaveBtn").show();
       
       $("#fromProcessBtn").hide();
       $("#taskType").hide();
       $("#categoriesOnTitle").show();
       
       if(taskType == 'instant')
        { 
            $("#findDoers").hide();
            initialize();
        }
        else
        {
             $("#findDoers").show();
        }
   }
   function formProcess()
   {
//       var  taskType = $('#selectTaskType').val();
//       if($('#selectCategory'+taskType).val())
//       {
//           $("#fromProcessBtn").prop("disabled", false);
//       }
//       else
//       {
//           $("#fromProcessBtn").prop("disabled", true);
//       }
return true;
   }
   function selectCategoryByTaskType(category_id)
   {
        var  taskType = $('#selectTaskType').val();
        
       $('#selectCategory'+taskType).val(category_id);
   }
//   function clearSelectedCategory()
//   {
//       $('#selectCategory').val() = '';
//       $('#selectTaskType').val() = '';
//   }
   function goStep1()
   {
       if($("#taskStep1").hasClass("vstep1b"))
       {
            $("#taskStep1").removeClass("vstep1b");
            $("#taskStep2").removeClass("vstep1a");
            $("#taskStep2").next().removeClass("vtext1");
           // $("#taskStep2").parent().removeClass("cursor-pointer");
            $("#accordionDiv").hide();
            $("#taskDetailFrom").hide();
            $("#taskSaveBtn").hide();
            $("#fromProcessBtn").show();
            $("#findDoers").hide();
            $("#taskType").show();
            $("#categoriesOnTitle").hide();
       }
       else
       {
           return false;
       }
        
   }
   function goStep2()
   {
       var  taskType = $('#selectTaskType').val();
      
       if($('#selectCategory'+taskType).val())
       {
           loaddetailform();
       }
       else
       {
           if($("#chooseCategory"+taskType).val())
           {
               alertErrorMessage("Please choose a subcategory.");
           }
           else
           {
               alertErrorMessage("Please choose a category.");
           }
           

       }
       
        
   }
   
   function estimatedCost()
   {
       var estimatedCost = 0;
       var avaragePrice = 0;
       if(parseInt($('#Task_min_price').val()) > 0  && parseInt($('#Task_max_price').val()) > 0)
        {
                avaragePrice =  (parseInt($('#Task_min_price').val()) + parseInt($('#Task_max_price').val())) / parseInt(2) ;
                estimatedCost = avaragePrice;
        }
      
        if( parseInt($('#Task_work_hrs').val()) > 0 )
        {
                avaragePrice = (parseInt($('#Task_work_hrs').val()) * Math.round(avaragePrice));
                estimatedCost = avaragePrice;
        }
        
       
        if( parseInt($('#Task_cash_required').val()) > 0 )
        {
                avaragePrice = avaragePrice + parseInt($('#Task_cash_required').val());
                estimatedCost = avaragePrice;
        }
 
        $('#Task_price').val(estimatedCost);
        $('#task_price_display_total').html(estimatedCost);
     // alert(avaragePrice);
   
   }
  
    function setdataInForm(data)
    {
        $('#Task_description').val(data.description);
        $('#Task_title').val(data.title);
        if( data.is_premium == 1 )
        {
            $('#Task_is_premium').parent().removeClass('switch-off');
            $('#Task_is_premium').parent().addClass('switch-on');
            $('#Task_is_premium').prop('disabled', false);
            $('#Task_is_premium').prop('checked', true);
        }
        else
        {
            $('#Task_is_premium').parent().removeClass('switch-on');
            $('#Task_is_premium').parent().addClass('switch-off');
            $('#Task_is_premium').prop('disabled', true);
            $('#Task_is_premium').prop('checked', false);
        }
        if( data.is_highlighted == 1 )
        {
            $('#Task_is_highlighted').parent().removeClass('switch-off');
            $('#Task_iis_highlighted').parent().addClass('switch-on');
            $('#Task_iis_highlighted').prop('disabled', false);
            $('#Task_iis_highlighted').prop('checked', true);
        }
        else
        {
            $('#Task_is_highlighted').parent().removeClass('switch-on');
            $('#Task_is_highlighted').parent().addClass('switch-off');
            $('#Task_is_highlighted').prop('disabled', true);
            $('#Task_is_highlighted').prop('checked', false);
        }
        if( data.is_public == 1 )
        {
            $('#Task_is_public').prop('checked', true);
        }
        else
        {
            $('#Task_is_private').prop('checked', true);
        }
        $('#Task_price').val(parseInt(data.price));
        $('#Task_min_price').val(parseInt(data.min_price));
        $('#Task_max_price').val(parseInt(data.max_price));
        $('#Task_task_cash_required').val(parseInt(data.task_cash_required));
        $('#Task_work_hrs').val(data.work_hrs);
        $('#Task_payment_mode').val(data.payment_mode);
        setPriceMode(data.payment_mode);
    }
    function selectQuestions(thisobj , dropDownId , actionDivId)
    {
    
        var queId = $(thisobj).val();
        var queText = $(thisobj).find("option:selected").text();
     
        
         $(thisobj).find("option:selected").prop('disabled', true);
         $(thisobj).find("option:selected").hide();
         $(thisobj).val("");
         
         addQuestionToForm(queId , queText , dropDownId , actionDivId  );
           
    }
   
    function resetQuetionsDropdown(dropDownId , val)
    {
       $("#"+dropDownId+" option[value='"+ val + "']").prop('disabled', false);
       $("#"+dropDownId+" option[value='"+ val + "']").show();
    }
    function addNewQuestion()
    {
        $("#createNewQuestion").show();
    }
    function addcustomQuestion(customQuestonId , dropDownId , actionDivId)
    {   
        var queId = '';
        var  queText = $("#"+customQuestonId).val();
        if(queText !='')
        {
            addQuestionToForm(queId , queText , dropDownId , actionDivId  );
            $("#createNewQuestion").hide();
        }
       $("#"+customQuestonId).val('');
    }
    function hideCustomQuestion(customQuestonId)
    {   
       
       
        $("#createNewQuestion").hide();
       
       $("#"+customQuestonId).val('');
    }
    function setActiveFilterTaskDetail(id)
    {
        $('#createTaskFormFilters ul li a').removeClass('active');
        $('#createTaskFormFilters ul li a#'+id).addClass('active');
    }
    function inviteAll()
    {
                var vals = $('.current_taskers_display').map(function(){
                var userDetail = $(this).val();
                var userDetailArray = userDetail.split('[,,]');
                var  userId = userDetailArray[0];
                var  userName = userDetailArray[1];
                var  userImg = userDetailArray[2];
                addTaskerToInvite(userId , userName , userImg)
            }).get();
            return vals;
        
    }
    
    
    function setInvitedUser(inviteBtnTarget , takerInfoOwter)
    {
        if(!inviteBtnTarget)
        {
            inviteBtnTarget = 'userInviteBtn';
        }
         if(!takerInfoOwter)
        {
            takerInfoOwter = 'takerInfoOwter';
        }
       // alert(inviteBtnTarget);
          var vals = $('.taskers_hidden').map(function(){
            var userId = $(this).val();
            $("#"+inviteBtnTarget+userId).addClass('invitedtasker');
              $("#"+takerInfoOwter+userId).addClass('invite-select');
            $("#"+inviteBtnTarget+userId).text('Invited');
            }).get();
            return vals;
           // alert(vals);
    }
    function removeAllInvited(removeID , targetDivId , taskerInvitedDivTitle)
    {
        if(!removeID)
        {
            removeID = 'invitedTaskersRemove';
        }
        if(!targetDivId)
        {
            targetDivId = 'invitedTaskers';
        }
       
        if(!taskerInvitedDivTitle)
        {
            taskerInvitedDivTitle = 'invitedTaskersTitle';
        }
       
            
          var vals = $('.taskers_hidden').map(function(){
            var userId = $(this).val();
                removeInvitedTasker(userId);
            }).get();
            $('#'+targetDivId).html("");
            $("#"+taskerInvitedDivTitle).hide();
            $("#"+removeID).hide();
            $('#'+targetDivId).hide();
            return vals;
           // alert(vals);
    }
    
    function removeInvitedTasker(userId ,removeID , targetDivId , taskerInvitedDivTitle )
    {
         if(!removeID)
        {
            removeID = 'invitedTaskersRemove';
        }
        if(!targetDivId)
        {
            targetDivId = 'invitedTaskers';
        }
       
        if(!taskerInvitedDivTitle)
        {
            taskerInvitedDivTitle = 'invitedTaskersTitle';
        }
        
            $("#userInviteBtn"+userId).removeClass('invitedtasker');
             $("#takerInfoOwter"+userId).removeClass('invite-select');
             $("#takerInfoOwterOnMap"+userId).removeClass('invite-select');
             $("#userInviteBtnOnMap"+userId).removeClass('invitedtasker');
             $("#userInviteBtnOnMap"+userId).text('Invite');
            $("#userInviteBtn"+userId).text('Invite');
            var userId;     
            var vals = $('.taskers_hidden').map(function(){
               return $(this).val();
            }).get();
            //alert(vals.length);
            if(vals.length <= 1)
            {
                $("#"+taskerInvitedDivTitle).hide();
                $("#"+removeID).hide();
                $("#"+targetDivId).hide();
                $('#'+targetDivId).html("");
                
            }
            
    }
    function filterBySkills()
    {
        var data = $('#multiskills').serialize();    
        $.fn.yiiListView.update('loadtaskerlist', {data: data});
    }
    function instantTaskTotalCost()
    {
        var estimatedCost =  '0' ;
        var minPrice =  '0' ;
        if(parseInt($('#Task_min_price').val()) >= 0 )
        {
            var minPrice = Math.round($('#Task_min_price').val());
            
        }
        if(parseInt($('#Task_cash_required').val()) >= 0)
        {
            var estimatedCost =  (Math.round(minPrice) + Math.round($('#Task_cash_required').val())) ;
        }
        $('#Task_price').val(estimatedCost);
        $('#Task_max_price').val(minPrice);
        $('#instantTotalPrice').html(estimatedCost);
    }
  
   function searchDoerBar()
   {
        $('#searchDoers').show();
   }
   function searchDoerBarHide()
   {
        $('#searchDoers').hide();
   }
  function goToInperson()
  {
        $('#task_description_instant_hidden').val($('#Task_description').val());
        $('#task_min_price_instant_hidden').val($('#Task_min_price').val());
        $('#task_cash_required_instant_hidden').val($('#Task_cash_required').val());
        $('#task_price_hidden').val($('#Task_price').val());
        $('#switch_to_person').val('1');
        getTaskType('inperson');
        goStep1();
  }
   function getBidCloseDate(days , targetDivID)
    {
        //var hoursInMinutes = endTimeHours * 60 ;
        if(days == '1 day')
        {
           days = '1';
        }
        else if(days == '1 week')
        {
            days = '7';
        }
        else if(days == '15 days')
        {
            days = '15';
        }
        else if(days == '1 month')
        {
            days = '30';
        }
        
        
        if($('#dateselected').val())
        {
             var date = new Date($('#dateselected').val().replace(/-/g, "/"));
            // alert($('#dateselected').val());
        }
        else
        {
             var date = new Date();
        }
       
  
        var endDateTime = date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        var endDate = new Date(endDateTime);
        var newDateFormate = 'MM dd, yy';
        
        var endDateFormated = $.formatDateTime(newDateFormate,endDate);
        $(targetDivID).html(endDateFormated);
        $(targetDivID + 'Container').show();
     
        
    }
    function getTaskCompleteTime(endTimeHours , targetDivID)
    {
        var hoursInMinutes = endTimeHours * 60 ;
        if($('#dateselected').val())
        {
             var date = new Date($('#dateselected').val());
        }
        else
        {
             var date = new Date();
        }
       
        var minutes = hoursInMinutes;
        var endDateTime = date.setTime(date.getTime() + (minutes * 60 * 1000));
        var endDate = new Date(endDateTime);
        var newDateFormate = 'MM dd, yy gg:ii a';
        
        var endDateFormated = $.formatDateTime(newDateFormate,endDate);
        $(targetDivID).html(endDateFormated);
        $(targetDivID + 'Container').show();
     
        
    }
$(document).ready(function(){

$('#accordion').on('shown.bs.collapse', function (e) {
    
    var openAnchor = $(this).find('a[data-toggle=collapse]:not(.collapsed):not(.collapsed2)');
    var sectionID = openAnchor.attr('href');
    $('#accordion .in').not(sectionID).parent('.panel').find( ".panel-heading .panel-title1 a" ).addClass('collapsed');
    $('#accordion .in').not(sectionID).collapse('hide');
    $('#accordion .panel .panel-heading .panel-title1 a').removeClass('collapsed2');
    $(sectionID).parent('.panel').find( ".panel-heading .panel-title1 a" ).addClass('collapsed2');
});
});